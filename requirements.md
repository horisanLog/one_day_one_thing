# One Day One Thing 要件定義書

**Version 1.0** | 2025.02.05

---

## 1. プロジェクト概要

### 1.1 プロジェクト名

One Day One Thing（ワンデイ・ワンシング）

### 1.2 プロジェクトの目的

AIが毎朝たった1つの「小さな体験」を提案することで、選択疲れに悩む現代人の日常に偶然の発見（セレンディピティ）を取り戻すWebアプリケーションを開発する。

### 1.3 背景

- 選択肢が多すぎて「何をすればいいか分からない」という現代人の疲弊
- 「遠くに行く」のではなく「今いる場所の豊かさに気づく」という新しいライフスタイルへのニーズ
- 副業として月10万円の安定収益を実現する持続可能なビジネスの構築

### 1.4 対象ユーザー

- **メインターゲット**: 都市部在住の25〜40歳、単身またはDINKS層
- **推定市場規模**: 約240万人（「休日の過ごし方に困る」層）

---

## 2. システム構成

### 2.1 システムアーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                      クライアント層                          │
├─────────────────────────────────────────────────────────────┤
│  Next.js Webアプリ（レスポンシブ・モバイルファースト）        │
│  - LP / サインアップ / 今日の提案表示 / 体験ログ              │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      アプリケーション層                      │
├─────────────────────────────────────────────────────────────┤
│  Next.js API Routes                                         │
│  - 認証API / 提案生成API / ログ管理API / 決済API             │
└─────────────────────────────────────────────────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          ▼                   ▼                   ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│   Supabase      │ │   外部API       │ │   外部サービス  │
│   (PostgreSQL)  │ │                 │ │                 │
│   - ユーザー    │ │ - Claude API    │ │ - Stripe        │
│   - 提案履歴    │ │ - OpenWeather   │ │ - LINE Messaging│
│   - 体験ログ    │ │                 │ │                 │
└─────────────────┘ └─────────────────┘ └─────────────────┘
```

### 2.2 技術スタック

| レイヤー | 技術 | バージョン要件 |
|:---------|:-----|:---------------|
| フロントエンド | Next.js (App Router) | 14.x以上 |
| UIフレームワーク | TailwindCSS | 3.x |
| バックエンド | Next.js API Routes | - |
| データベース | Supabase (PostgreSQL) | - |
| 認証 | Supabase Auth | - |
| AI | Claude API | claude-sonnet-4-20250514 |
| 天気情報 | OpenWeather API | 3.0 |
| 決済 | Stripe（※50人達成後に導入） | - |
| ホスティング | Vercel | - |
| 通知 | LINE Messaging API | - |

---

## 3. 機能要件

### 3.1 機能一覧

| ID | 機能名 | 優先度 | プラン |
|:---|:-------|:-------|:-------|
| F-001 | ユーザー登録・認証 | 必須 | 共通 |
| F-002 | 今日の提案表示 | 必須 | 共通 |
| F-003 | 体験記録（やった/スキップ） | 必須 | 共通 |
| F-004 | LINE通知連携 | 必須 | 共通 |
| F-005 | シェアカード生成 | 必須 | 共通 |
| F-006 | 体験ログ閲覧 | 必須 | 制限付き |
| F-007 | パーソナライズ提案 | 必須 | プレミアム |
| F-008 | 月次レポート | 高 | プレミアム |
| F-009 | ジャンル設定 | 高 | プレミアム |
| F-010 | サブスクリプション決済 | 必須（※50人達成後） | - |
| F-011 | ユーザー設定 | 必須 | 共通 |

---

### 3.2 機能詳細

#### F-001: ユーザー登録・認証

**概要**: ユーザーがアカウントを作成し、ログインできる機能

**機能要件**:
- FR-001-01: Googleアカウントでのソーシャルログインが可能であること
- FR-001-02: メールアドレス・パスワードでの登録・ログインが可能であること
- FR-001-03: パスワードリセット機能を提供すること
- FR-001-04: ログアウト機能を提供すること
- FR-001-05: アカウント削除機能を提供すること（個人情報保護法対応）

> **注**: LINEログインはSupabase Authが未対応のため、認証はGoogle + メールに限定。LINE連携は通知機能（友だち追加）で別途実装。

**画面**:
- サインアップ画面
- ログイン画面
- パスワードリセット画面

---

#### F-002: 今日の提案表示

**概要**: AIが生成した今日の体験提案を表示する機能

**機能要件**:
- FR-002-01: ログイン後のホーム画面に今日の提案を1つ表示すること
- FR-002-02: 提案は毎日午前6時に更新されること
- FR-002-03: 提案には以下の要素を含むこと
  - タイトル（1行）
  - 本文（2〜3行）
  - 結び（1行の詩的な一文）
- FR-002-04: 無料プランでは汎用的な提案を表示すること
- FR-002-05: プレミアムプランでは天気・気分・履歴に基づく個人化提案を表示すること

**提案生成ロジック**:

| コンテキスト変数 | データソース | 影響 |
|:-----------------|:-------------|:-----|
| 天気 | OpenWeather API | 屋外/屋内の判断 |
| 気温 | OpenWeather API | 活動強度の調整 |
| 曜日 | システム日時 | 平日→マイクロ、休日→探検系 |
| 季節・暦 | システム日時 + 日本の暦 | 季節感のある提案 |
| ユーザーの気分 | ユーザー入力（任意） | トーン調整 |
| 履歴 | DB | 重複回避、嗜好学習 |
| エリアタイプ | ユーザープロフィール | 実現可能性判断 |

**提案カテゴリ**:
1. 五感 - 日常の中で五感を働かす瞬間
2. 探検 - 見慣れた環境の中で何かを発見する
3. プチ冒険 - ルーティンからの小さな逸脱
4. マインドフルネス - 意図的に何もしない、ペースを落とす
5. つながり - 小さな人とのつながり
6. 創作 - 何か小さなものを作る
7. 内省 - 自分の内側を見つめる

---

#### F-003: 体験記録（やった/スキップ）

**概要**: 提案に対するユーザーのアクションを記録する機能

**機能要件**:
- FR-003-01: 提案画面に「やった」「スキップ」ボタンを表示すること
- FR-003-02: 「やった」選択時に任意の1行メモを入力できること
- FR-003-03: 「やった」選択時に任意の写真を1枚添付できること
- FR-003-04: 記録データは履歴DBに保存されること
- FR-003-05: 「やった」「スキップ」の結果は次回以降の提案生成に活用されること

---

#### F-004: LINE通知連携

**概要**: LINEを通じて毎朝の提案を配信する機能

**機能要件**:
- FR-004-01: LINE公式アカウントを友だち追加で連携できること
- FR-004-02: 毎朝7:00 JSTに全ユーザーへ提案を一斉配信すること
- FR-004-03: ユーザーがLINE通知のON/OFFを切り替えられること
- FR-004-04: LINE内から直接Webアプリにアクセスできるリンクを含むこと

> **注**: 配信時刻のカスタマイズはMVP対象外。全員同じ時刻（7:00 JST）に配信。

---

#### F-005: シェアカード生成

**概要**: 体験をSNSでシェアするための画像カードを生成する機能

**機能要件**:
- FR-005-01: 「やった」記録時にシェアカードを自動生成すること
- FR-005-02: シェアカードには以下を含むこと
  - 提案タイトル
  - 日付
  - アプリロゴ/ブランド名
  - ユーザーの写真（添付時）
- FR-005-03: 無料プランではベーシックデザインを提供すること
- FR-005-04: プレミアムプランでは複数のプレミアムデザインから選択可能であること
- FR-005-05: X（Twitter）、Instagramへの直接シェア機能を提供すること
- FR-005-06: 画像のダウンロード機能を提供すること

---

#### F-006: 体験ログ閲覧

**概要**: 過去の体験記録を閲覧する機能

**機能要件**:
- FR-006-01: カレンダー形式で過去の体験を一覧表示すること
- FR-006-02: 各日付をタップすると詳細（提案内容、メモ、写真）を表示すること
- FR-006-03: 無料プランでは直近7日間のみ閲覧可能であること
- FR-006-04: プレミアムプランでは全期間の閲覧が可能であること
- FR-006-05: 「やった」「スキップ」のフィルタリング機能を提供すること

---

#### F-007: パーソナライズ提案

**概要**: ユーザーの履歴・設定に基づいて提案を個人化する機能（プレミアム）

**機能要件**:
- FR-007-01: 過去の「やった」「スキップ」履歴を分析し、嗜好を学習すること
- FR-007-02: 同じ提案が短期間で繰り返されないようにすること
- FR-007-03: 天気・気温に応じた提案の自動調整を行うこと
- FR-007-04: ユーザーの気分入力に応じたトーン調整を行うこと
- FR-007-05: 居住エリアタイプに応じた実現可能な提案を生成すること

---

#### F-008: 月次レポート

**概要**: 月間の体験を振り返るサマリーレポートを生成する機能（プレミアム）

**機能要件**:
- FR-008-01: 毎月1日に前月のレポートを生成すること
- FR-008-02: レポートには以下を含むこと
  - 月間の「やった」数
  - 最も多かったカテゴリ
  - 連続達成日数（ストリーク）
  - 印象的な体験のハイライト
- FR-008-03: レポートをLINEで通知すること
- FR-008-04: Webアプリ内でレポート履歴を閲覧できること

---

#### F-009: ジャンル設定

**概要**: 提案カテゴリの好みを設定する機能（プレミアム）

**機能要件**:
- FR-009-01: 7つのカテゴリの表示頻度を調整できること
- FR-009-02: 特定カテゴリの非表示設定ができること
- FR-009-03: 設定は即座に次回以降の提案に反映されること

---

#### F-010: サブスクリプション決済（※50人達成後に実装）

**概要**: プレミアムプランの課金を管理する機能

> **注意**: この機能はユーザー数が50人に達してから実装します。MVP期間中は全機能を無料で提供します。

**機能要件**:
- FR-010-01: Stripeを利用した月額サブスクリプション決済が可能であること
- FR-010-02: 料金: 月額480円（税込）
- FR-010-03: クレジットカード決済に対応すること
- FR-010-04: いつでも解約可能であること
- FR-010-05: 解約後は当月末までプレミアム機能を利用可能であること
- FR-010-06: 決済履歴の確認機能を提供すること
- FR-010-07: 領収書のダウンロード機能を提供すること

---

#### F-011: ユーザー設定

**概要**: ユーザープロフィールと各種設定を管理する機能

**機能要件**:
- FR-011-01: ニックネームの設定・変更ができること
- FR-011-02: 居住エリアタイプ（都市部/郊外/地方）の設定ができること
- FR-011-03: LINE通知のON/OFF切り替えができること
- FR-011-04: プライバシー設定（データ利用の同意管理）ができること
- FR-011-05: アカウント削除申請ができること

---

## 4. 非機能要件

### 4.1 性能要件

| 項目 | 要件 |
|:-----|:-----|
| 画面表示速度 | 初回ロード: 3秒以内、画面遷移: 1秒以内 |
| API応答時間 | 提案生成以外: 500ms以内 |
| AI提案生成時間 | 5秒以内 |
| 同時接続数 | 100ユーザー以上 |
| 可用性 | 99.5%以上（月間ダウンタイム3.6時間以内） |

### 4.2 セキュリティ要件

| 項目 | 要件 |
|:-----|:-----|
| 通信暗号化 | HTTPS (TLS 1.3) |
| 認証 | JWT + Supabase Auth |
| パスワード | bcryptによるハッシュ化 |
| 決済情報 | Stripe側で管理（PCI DSS準拠） |
| 個人情報 | 個人情報保護法に準拠した取り扱い |
| API保護 | Rate Limiting実装 |

### 4.3 ユーザビリティ要件

| 項目 | 要件 |
|:-----|:-----|
| レスポンシブ対応 | スマートフォン優先（モバイルファースト） |
| 対応ブラウザ | Chrome, Safari, Edge（最新2バージョン） |
| 対応デバイス | iOS 14+, Android 10+, デスクトップ |
| アクセシビリティ | WCAG 2.1 Level AA準拠を目指す |
| 多言語対応 | MVP: 日本語のみ |

### 4.4 保守性要件

| 項目 | 要件 |
|:-----|:-----|
| コードスタイル | ESLint + Prettier準拠 |
| テストカバレッジ | 主要機能: 80%以上 |
| ドキュメント | API仕様書、デプロイ手順書 |
| ログ | エラーログ、アクセスログの出力 |
| モニタリング | Vercel Analytics + エラー監視 |

---

## 5. データ要件

### 5.1 データモデル

#### users（ユーザー）

| カラム名 | 型 | 説明 | 制約 |
|:---------|:---|:-----|:-----|
| id | uuid | ユーザーID | PK |
| email | varchar(255) | メールアドレス | UNIQUE, NOT NULL |
| nickname | varchar(50) | ニックネーム | - |
| area_type | varchar(20) | エリアタイプ | enum: urban/suburban/rural |
| is_premium | boolean | プレミアム会員フラグ | DEFAULT false |
| line_user_id | varchar(100) | LINE ユーザーID | UNIQUE |
| line_notification_enabled | boolean | LINE通知ON/OFF | DEFAULT true |
| created_at | timestamp | 作成日時 | NOT NULL |
| updated_at | timestamp | 更新日時 | NOT NULL |

#### suggestions（提案）

| カラム名 | 型 | 説明 | 制約 |
|:---------|:---|:-----|:-----|
| id | uuid | 提案ID | PK |
| user_id | uuid | ユーザーID | FK(users.id), NOT NULL |
| date | date | 提案日 | NOT NULL |
| title | varchar(100) | タイトル | NOT NULL |
| body | text | 本文 | NOT NULL |
| closing | varchar(200) | 結び | NOT NULL |
| category | varchar(30) | カテゴリ | NOT NULL |
| context_data | jsonb | 生成時のコンテキスト | - |
| created_at | timestamp | 作成日時 | NOT NULL |

**制約**: `(user_id, date)` にUNIQUE制約（1ユーザー1日1提案を保証）

#### experience_logs（体験ログ）

| カラム名 | 型 | 説明 | 制約 |
|:---------|:---|:-----|:-----|
| id | uuid | ログID | PK |
| user_id | uuid | ユーザーID | FK(users.id), NOT NULL |
| suggestion_id | uuid | 提案ID | FK(suggestions.id), NOT NULL |
| status | varchar(20) | ステータス | enum: done/skipped, NOT NULL |
| memo | varchar(200) | メモ | - |
| photo_url | varchar(500) | 写真URL | - |
| recorded_at | timestamp | 記録日時 | NOT NULL |

**制約**: `(user_id, suggestion_id)` にUNIQUE制約（1提案に対する記録の重複を防止）

#### subscriptions（サブスクリプション）

| カラム名 | 型 | 説明 | 制約 |
|:---------|:---|:-----|:-----|
| id | uuid | サブスクリプションID | PK |
| user_id | uuid | ユーザーID | FK(users.id), UNIQUE, NOT NULL |
| stripe_subscription_id | varchar(100) | Stripe サブスクID | NOT NULL |
| status | varchar(20) | ステータス | enum: active/canceled/past_due |
| current_period_end | timestamp | 現在の期間終了日 | NOT NULL |
| created_at | timestamp | 作成日時 | NOT NULL |
| updated_at | timestamp | 更新日時 | NOT NULL |

#### mood_logs（気分ログ）

| カラム名 | 型 | 説明 | 制約 |
|:---------|:---|:-----|:-----|
| id | uuid | ログID | PK |
| user_id | uuid | ユーザーID | FK(users.id), NOT NULL |
| date | date | 日付 | NOT NULL |
| mood | varchar(20) | 気分 | enum: great/good/normal/tired/low |
| created_at | timestamp | 作成日時 | NOT NULL |

**制約**: `(user_id, date)` にUNIQUE制約（1ユーザー1日1気分記録を保証。同日の再入力は上書き更新）

### 5.2 データ保持期間

| データ種別 | 保持期間 |
|:-----------|:---------|
| ユーザーデータ | アカウント削除まで |
| 体験ログ | 無期限 |
| 提案データ | 2年間 |
| 決済履歴 | 7年間（法定保存期間） |
| ログデータ | 90日間 |

---

## 6. 外部インターフェース

### 6.1 API一覧

| エンドポイント | メソッド | 説明 |
|:---------------|:---------|:-----|
| /api/auth/callback | GET | Supabase Auth OAuthコールバック |
| /api/suggestions/today | GET | 今日の提案取得 |
| /api/suggestions/generate | POST | 提案生成（内部用） |
| /api/logs | POST | 体験記録 |
| /api/logs | GET | 体験ログ一覧取得 |
| /api/mood | POST | 気分記録 |
| /api/share-card | POST | シェアカード生成 |
| /api/subscription/create | POST | サブスク作成（※50人達成後） |
| /api/subscription/cancel | POST | サブスク解約（※50人達成後） |
| /api/settings | GET/PUT | ユーザー設定 |
| /api/reports/monthly | GET | 月次レポート取得 |

### 6.2 外部API連携

| サービス | 用途 | 認証方式 |
|:---------|:-----|:---------|
| Claude API | 提案文生成 | API Key |
| OpenWeather API | 天気情報取得 | API Key |
| Stripe API | 決済処理（※50人達成後） | Secret Key |
| LINE Messaging API | 通知配信 | Channel Access Token |
| Supabase Auth | 認証 | JWT |

---

## 7. 画面一覧

### 7.1 画面構成

| 画面ID | 画面名 | 概要 | 認証 |
|:-------|:-------|:-----|:-----|
| SCR-001 | LP（ランディングページ） | サービス紹介 | 不要 |
| SCR-002 | サインアップ | 新規登録 | 不要 |
| SCR-003 | ログイン | ログイン | 不要 |
| SCR-004 | ホーム | 今日の提案表示 | 必要 |
| SCR-005 | 記録完了 | やった/スキップ後の確認 | 必要 |
| SCR-006 | 体験ログ | 過去の体験一覧 | 必要 |
| SCR-007 | 体験詳細 | 体験の詳細表示 | 必要 |
| SCR-008 | シェアカード | SNSシェア画面 | 必要 |
| SCR-009 | 設定 | ユーザー設定 | 必要 |
| SCR-010 | プラン選択 | プレミアムプラン紹介（※50人達成後） | 必要 |
| SCR-011 | 決済 | Stripeチェックアウト（※50人達成後） | 必要 |
| SCR-012 | 月次レポート | 月間振り返り | 必要 |
| SCR-013 | プライバシーポリシー | 法的文書 | 不要 |
| SCR-014 | 利用規約 | 法的文書 | 不要 |
| SCR-015 | 特定商取引法表示 | 法的文書 | 不要 |

---

## 8. 制約条件

### 8.1 開発制約

| 項目 | 制約内容 |
|:-----|:---------|
| 開発者 | 1名（創業者本人、副業） |
| 開発時間 | 週15〜20時間 |
| 初期予算 | 0円（無料プラン活用） |
| MVP期間 | 2ヶ月 |

### 8.2 技術制約

| 項目 | 制約内容 |
|:-----|:---------|
| ネイティブアプリ | MVP対象外（Webファーストアプローチ） |
| プッシュ通知 | LINEでの代替（ネイティブ不要） |
| 位置情報 | 詳細位置情報はMVP対象外 |

### 8.3 運用制約

| 項目 | 月間コスト上限 |
|:-----|:---------------|
| Vercel | 0〜3,000円 |
| Supabase | 0〜3,800円 |
| AI API | 約6,000円（200ユーザー時） |
| LINE公式 | 0〜5,500円 |
| 合計 | 約10,000円 |

---

## 9. 法的要件・コンプライアンス

### 9.1 対応必須法令

| 法令 | 対応内容 |
|:-----|:---------|
| 個人情報保護法 | プライバシーポリシー作成、データ削除対応 |
| 特定商取引法 | 必要事項の表示ページ設置 |
| 利用規約 | AI生成コンテンツの免責事項明記 |

### 9.2 リリース前チェックリスト

- [ ] プライバシーポリシー作成
- [ ] 利用規約作成
- [ ] 特定商取引法に基づく表示ページ作成
- [ ] Cookie同意バナー実装
- [ ] データ削除フローの構築

---

## 10. 成功基準（MVP検証）

### 10.1 定量指標（ベータテスト30日後）

| 指標 | 目標値 |
|:-----|:-------|
| 提案受入率（「やった」） | 30%以上 |
| 7日継続率 | 40%以上 |
| SNSシェア数 | 5件以上（自発的） |
| 課金意向（アンケート） | 20%以上が「はい」 |

### 10.2 定性指標

- 「毎朝の提案が楽しみ」という声の確認
- 「日常が豊かになった」というフィードバック

---

## 11. 用語定義

| 用語 | 定義 |
|:-----|:-----|
| 提案 | AIが生成する1日1つの体験提案 |
| 体験ログ | ユーザーの「やった」「スキップ」の記録 |
| シェアカード | SNS共有用に生成される画像 |
| WAE | Weekly Active Experiencers（週1回以上提案を実行したユーザー数） |
| マイクロ体験 | 30分以内、ゼロコストで実行可能な小さな体験 |

---

## 付録A: プラン比較

> **MVP期間（〜50人）**：全機能を無料で提供。50人達成後に有料プランを導入。

| 機能 | 無料プラン | プレミアム（月額480円）※50人達成後 |
|:-----|:----------|:----------------------------------|
| 毎日の提案 | 汎用的な提案 | 個人化提案 |
| 体験ログ | 直近7日間 | 無制限 |
| 月次レポート | ✕ | ○ |
| ジャンル設定 | ✕ | ○ |
| シェアカードデザイン | ベーシック | プレミアム |

---

## 付録B: ワイヤーフレーム概要

### ホーム画面（SCR-004）

```
┌─────────────────────────────────┐
│  One Day One Thing      [設定] │
├─────────────────────────────────┤
│                                 │
│  2025年2月5日（水）             │
│  曇り / 8°C                     │
│                                 │
│  ─────────────────────────      │
│                                 │
│  📍 今日のひとつ                │
│                                 │
│  「通勤途中、今日の空の          │
│   グレーの濃淡を数えてみて」    │
│                                 │
│  思ったよりたくさんの色が       │
│  見つかるかもしれません。       │
│                                 │
│  ─ 空は、毎日違う顔をしている   │
│                                 │
│  ─────────────────────────      │
│                                 │
│  [  やった  ]  [  スキップ  ]   │
│                                 │
├─────────────────────────────────┤
│  [ホーム]  [ログ]  [設定]       │
└─────────────────────────────────┘
```

---

**以上**

**作成日**: 2025年2月5日
**バージョン**: 1.0
